# global options
{
    admin off # Pas besoin de l'API admin dans l'environnement de Railway
    persist_config off # Le stockage n'est pas persistant
    auto_https off # Railway gère HTTPS pour nous
    # Logs d'exécution
    log {
        format json # Format des logs en JSON
    }
    # Options du serveur
    servers {
        trusted_proxies static private_ranges 100.0.0.0/8 # Faire confiance au proxy de Railway
    }
}

# Site block, écoute sur la variable d'environnement $PORT (fournie par Railway)
:{$PORT:3000} {
    # Logs d'accès
    log {
        format json # Format des logs d'accès en JSON
    }

    # Health check pour Railway
    rewrite /health /*

    # Servir depuis le dossier 'dist' (où Vite ou react-scripts buildent)
    root * dist

    # Activer la compression gzip
    encode gzip

    # Servir les fichiers depuis 'dist'
    file_server

    # Si le chemin n'existe pas, rediriger vers 'index.html' pour le routage côté client
    try_files {path} /index.html
}